{"ast":null,"code":"/*!\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport _asyncToGenerator from '@babel/runtime/helpers/asyncToGenerator';\nimport _slicedToArray from '@babel/runtime/helpers/slicedToArray';\nimport _regeneratorRuntime from '@babel/runtime/regenerator';\nimport * as React from 'react';\nimport { AuthSdkError, toRelativeUrl } from '@okta/okta-auth-js';\nimport { compare } from 'compare-versions';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport _objectWithoutProperties from '@babel/runtime/helpers/objectWithoutProperties';\nimport * as ReactRouterDom from 'react-router-dom';\nvar OktaContext = /*#__PURE__*/React.createContext(null);\nvar useOktaAuth = function useOktaAuth() {\n  return React.useContext(OktaContext);\n};\nvar OktaError = function OktaError(_ref) {\n  var error = _ref.error;\n  if (error.name && error.message) {\n    return /*#__PURE__*/React.createElement(\"p\", null, error.name, \": \", error.message);\n  }\n  return /*#__PURE__*/React.createElement(\"p\", null, \"Error: \", error.toString());\n};\nvar Security = function Security(_ref) {\n  var oktaAuth = _ref.oktaAuth,\n    restoreOriginalUri = _ref.restoreOriginalUri,\n    onAuthRequired = _ref.onAuthRequired,\n    children = _ref.children;\n  var _React$useState = React.useState(function () {\n      if (!oktaAuth) {\n        return null;\n      }\n      return oktaAuth.authStateManager.getAuthState();\n    }),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    authState = _React$useState2[0],\n    setAuthState = _React$useState2[1];\n  React.useEffect(function () {\n    if (!oktaAuth || !restoreOriginalUri) {\n      return;\n    }\n    if (oktaAuth.options.restoreOriginalUri) {\n      console.warn('Two custom restoreOriginalUri callbacks are detected. The one from the OktaAuth configuration will be overridden by the provided restoreOriginalUri prop from the Security component.');\n    }\n    oktaAuth.options.restoreOriginalUri = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(oktaAuth, originalUri) {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                restoreOriginalUri(oktaAuth, originalUri);\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n      return function (_x, _x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n  }, []);\n  React.useEffect(function () {\n    if (!oktaAuth) {\n      return;\n    }\n    if (oktaAuth._oktaUserAgent) {\n      oktaAuth._oktaUserAgent.addEnvironment(\"@okta/okta-react\".concat(\"/\", \"6.7.0\"));\n    } else {\n      console.warn('_oktaUserAgent is not available on auth SDK instance. Please use okta-auth-js@^5.3.1 .');\n    }\n    var currentAuthState = oktaAuth.authStateManager.getAuthState();\n    if (currentAuthState !== authState) {\n      setAuthState(currentAuthState);\n    }\n    var handler = function handler(authState) {\n      setAuthState(authState);\n    };\n    oktaAuth.authStateManager.subscribe(handler);\n    oktaAuth.start();\n    return function () {\n      oktaAuth.authStateManager.unsubscribe(handler);\n    };\n  }, [oktaAuth]);\n  if (!oktaAuth) {\n    var err = new AuthSdkError('No oktaAuth instance passed to Security Component.');\n    return /*#__PURE__*/React.createElement(OktaError, {\n      error: err\n    });\n  }\n  if (!restoreOriginalUri) {\n    var _err = new AuthSdkError('No restoreOriginalUri callback passed to Security Component.');\n    return /*#__PURE__*/React.createElement(OktaError, {\n      error: _err\n    });\n  }\n  if (!oktaAuth._oktaUserAgent) {\n    console.warn('_oktaUserAgent is not available on auth SDK instance. Please use okta-auth-js@^5.3.1 .');\n  } else {\n    var isAuthJsSupported = compare(oktaAuth._oktaUserAgent.getVersion(), {\n      \"minSupportedVersion\": \"5.3.1\"\n    }.minSupportedVersion, '>=');\n    if (!isAuthJsSupported) {\n      var _err2 = new AuthSdkError(\"\\n        Passed in oktaAuth is not compatible with the SDK,\\n        minimum supported okta-auth-js version is \".concat({\n        \"minSupportedVersion\": \"5.3.1\"\n      }.minSupportedVersion, \".\\n      \"));\n      return /*#__PURE__*/React.createElement(OktaError, {\n        error: _err2\n      });\n    }\n  }\n  return /*#__PURE__*/React.createElement(OktaContext.Provider, {\n    value: {\n      oktaAuth: oktaAuth,\n      authState: authState,\n      _onAuthRequired: onAuthRequired\n    }\n  }, children);\n};\nfunction ownKeys$1(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread$1(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys$1(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$1(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nvar withOktaAuth = function withOktaAuth(ComponentToWrap) {\n  var WrappedComponent = function WrappedComponent(props) {\n    var oktaAuthProps = useOktaAuth();\n    return /*#__PURE__*/React.createElement(ComponentToWrap, _objectSpread$1(_objectSpread$1({}, oktaAuthProps), props));\n  };\n  WrappedComponent.displayName = 'withOktaAuth_' + (ComponentToWrap.displayName || ComponentToWrap.name);\n  return WrappedComponent;\n};\nvar LoginCallback = function LoginCallback(_ref) {\n  var errorComponent = _ref.errorComponent,\n    _ref$loadingElement = _ref.loadingElement,\n    loadingElement = _ref$loadingElement === void 0 ? null : _ref$loadingElement,\n    onAuthResume = _ref.onAuthResume;\n  var _useOktaAuth = useOktaAuth(),\n    oktaAuth = _useOktaAuth.oktaAuth,\n    authState = _useOktaAuth.authState;\n  var _React$useState = React.useState(null),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    callbackError = _React$useState2[0],\n    setCallbackError = _React$useState2[1];\n  var ErrorReporter = errorComponent || OktaError;\n  React.useEffect(function () {\n    var isInteractionRequired = oktaAuth.idx.isInteractionRequired || oktaAuth.isInteractionRequired.bind(oktaAuth);\n    if (onAuthResume && isInteractionRequired()) {\n      onAuthResume();\n      return;\n    }\n    oktaAuth.handleLoginRedirect()[\"catch\"](function (e) {\n      setCallbackError(e);\n    });\n  }, [oktaAuth]);\n  var authError = authState === null || authState === void 0 ? void 0 : authState.error;\n  var displayError = callbackError || authError;\n  if (displayError) {\n    return /*#__PURE__*/React.createElement(ErrorReporter, {\n      error: displayError\n    });\n  }\n  return loadingElement;\n};\nvar _excluded = [\"onAuthRequired\", \"errorComponent\"];\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nvar useMatch;\nif ('useRouteMatch' in ReactRouterDom) {\n  useMatch = ReactRouterDom['useRouteMatch' in ReactRouterDom ? 'useRouteMatch' : ''];\n} else {\n  useMatch = function useMatch() {\n    throw new AuthSdkError('Unsupported: SecureRoute only works with react-router-dom v5 or any router library with compatible APIs. See examples under the \"samples\" folder for how to implement your own custom SecureRoute Component.');\n  };\n}\nvar SecureRoute = function SecureRoute(_ref) {\n  var onAuthRequired = _ref.onAuthRequired,\n    errorComponent = _ref.errorComponent,\n    routeProps = _objectWithoutProperties(_ref, _excluded);\n  var _useOktaAuth = useOktaAuth(),\n    oktaAuth = _useOktaAuth.oktaAuth,\n    authState = _useOktaAuth.authState,\n    _onAuthRequired = _useOktaAuth._onAuthRequired;\n  var match = useMatch(routeProps);\n  var pendingLogin = React.useRef(false);\n  var _React$useState = React.useState(null),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    handleLoginError = _React$useState2[0],\n    setHandleLoginError = _React$useState2[1];\n  var ErrorReporter = errorComponent || OktaError;\n  React.useEffect(function () {\n    var handleLogin = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var originalUri, onAuthRequiredFn;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!pendingLogin.current) {\n                  _context.next = 2;\n                  break;\n                }\n                return _context.abrupt(\"return\");\n              case 2:\n                pendingLogin.current = true;\n                originalUri = toRelativeUrl(window.location.href, window.location.origin);\n                oktaAuth.setOriginalUri(originalUri);\n                onAuthRequiredFn = onAuthRequired || _onAuthRequired;\n                if (!onAuthRequiredFn) {\n                  _context.next = 11;\n                  break;\n                }\n                _context.next = 9;\n                return onAuthRequiredFn(oktaAuth);\n              case 9:\n                _context.next = 13;\n                break;\n              case 11:\n                _context.next = 13;\n                return oktaAuth.signInWithRedirect();\n              case 13:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n      return function handleLogin() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    if (!match) {\n      return;\n    }\n    if (!authState) {\n      return;\n    }\n    if (authState.isAuthenticated) {\n      pendingLogin.current = false;\n      return;\n    }\n    if (!authState.isAuthenticated) {\n      handleLogin()[\"catch\"](function (err) {\n        setHandleLoginError(err);\n      });\n    }\n  }, [authState, oktaAuth, match, onAuthRequired, _onAuthRequired]);\n  if (handleLoginError) {\n    return /*#__PURE__*/React.createElement(ErrorReporter, {\n      error: handleLoginError\n    });\n  }\n  if (!authState || !authState.isAuthenticated) {\n    return null;\n  }\n  return /*#__PURE__*/React.createElement(ReactRouterDom.Route, _objectSpread({}, routeProps));\n};\nexport { LoginCallback, OktaContext, SecureRoute, Security, useOktaAuth, withOktaAuth };","map":{"version":3,"names":["_asyncToGenerator","_slicedToArray","React","AuthSdkError","toRelativeUrl","_defineProperty","_objectWithoutProperties","ReactRouterDom","OktaContext","createContext","useOktaAuth","OktaError","_ref","error","createElement","name","message","toString","Security","oktaAuth","restoreOriginalUri","onAuthRequired","_React$useState","useState","authStateManager","getAuthState","authState","_React$useState2","setAuthState","useEffect","options","console","warn","_ref2","_regeneratorRuntime","mark","_callee","originalUri","wrap","_callee$","_context","prev","next","stop","_x","_x2","apply","arguments","_oktaUserAgent","addEnvironment","concat","currentAuthState","handler","subscribe","unsubscribe","err","_err","isAuthJsSupported","compare","getVersion","_err2","minSupportedVersion","value","_onAuthRequired","ownKeys$1","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","_objectSpread$1","LoginCallback","target","i","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","withOktaAuth","ComponentToWrap","WrappedComponent","props","oktaAuthProps","displayName","errorComponent","loadingElement","_ref$loadingElement","onAuthResume","_useOktaAuth","callbackError","setCallbackError","ErrorReporter","isInteractionRequired","idx","bind","e","displayError","_excluded","_objectSpread","ownKeys","useMatch","routeProps","match","pendingLogin","useRef","setHandleLoginError","handleLogin","onAuthRequiredFn","window","location","href","origin","setOriginalUri","signInWithRedirect","isAuthenticated","current"],"sources":["C:\\Users\\cpecv\\OneDrive\\Рабочий стол\\Lab13\\node_modules\\@okta\\src\\OktaContext.ts","C:\\Users\\cpecv\\OneDrive\\Рабочий стол\\Lab13\\node_modules\\@okta\\src\\OktaError.tsx","C:\\Users\\cpecv\\OneDrive\\Рабочий стол\\Lab13\\node_modules\\@okta\\src\\Security.tsx","C:\\Users\\cpecv\\OneDrive\\Рабочий стол\\Lab13\\node_modules\\@okta\\src\\withOktaAuth.tsx","C:\\Users\\cpecv\\OneDrive\\Рабочий стол\\Lab13\\node_modules\\@okta\\src\\LoginCallback.tsx","C:\\Users\\cpecv\\OneDrive\\Рабочий стол\\Lab13\\node_modules\\@okta\\src\\SecureRoute.tsx"],"sourcesContent":["/*\n * Copyright (c) 2020-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\nimport * as React from 'react';\nimport { AuthState, OktaAuth } from '@okta/okta-auth-js';\n\nexport type OnAuthRequiredFunction = (oktaAuth: OktaAuth) => Promise<void> | void;\nexport type OnAuthResumeFunction = () => void;\n\nexport type RestoreOriginalUriFunction = (oktaAuth: OktaAuth, originalUri: string) => Promise<void> | void;\n\nexport interface IOktaContext {\n    oktaAuth: OktaAuth;\n    authState: AuthState | null;\n    _onAuthRequired?: OnAuthRequiredFunction;\n}\n\nconst OktaContext = React.createContext<IOktaContext | null>(null);\n\nexport const useOktaAuth = (): IOktaContext => React.useContext(OktaContext) as IOktaContext;\n\nexport default OktaContext;\n","/*\n * Copyright (c) 2020-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\n\nconst OktaError: React.FC<{ error: Error }> = ({ error }) => { \n  if(error.name && error.message) { \n    return <p>{error.name}: {error.message}</p>;\n  }\n  return <p>Error: {error.toString()}</p>;\n};\n\nexport default OktaError;\n","/*!\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\nimport { AuthSdkError, AuthState, OktaAuth } from '@okta/okta-auth-js';\nimport OktaContext, { OnAuthRequiredFunction, RestoreOriginalUriFunction } from './OktaContext';\nimport OktaError from './OktaError';\nimport { compare as compareVersions } from 'compare-versions';\n\ndeclare const AUTH_JS: {\n  minSupportedVersion: string;\n}\n\ndeclare const PACKAGE_NAME: string;\ndeclare const PACKAGE_VERSION: string;\ndeclare const SKIP_VERSION_CHECK: string;\n\nconst Security: React.FC<{\n  oktaAuth: OktaAuth,\n  restoreOriginalUri: RestoreOriginalUriFunction, \n  onAuthRequired?: OnAuthRequiredFunction,\n  children?: React.ReactNode\n} & React.HTMLAttributes<HTMLDivElement>> = ({ \n  oktaAuth,\n  restoreOriginalUri, \n  onAuthRequired, \n  children\n}) => { \n  const [authState, setAuthState] = React.useState(() => {\n    if (!oktaAuth) {\n      return null;\n    }\n    return oktaAuth.authStateManager.getAuthState();\n  });\n\n  React.useEffect(() => {\n    if (!oktaAuth || !restoreOriginalUri) {\n      return;\n    }\n\n    // Add default restoreOriginalUri callback\n    // props.restoreOriginalUri is required, therefore if options.restoreOriginalUri exists, there are 2 callbacks\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    if (oktaAuth.options.restoreOriginalUri) {\n      console.warn('Two custom restoreOriginalUri callbacks are detected. The one from the OktaAuth configuration will be overridden by the provided restoreOriginalUri prop from the Security component.');\n    }\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    oktaAuth.options.restoreOriginalUri = (async (oktaAuth: unknown, originalUri: string) => {\n      restoreOriginalUri(oktaAuth as OktaAuth, originalUri);\n    }) as ((oktaAuth: OktaAuth, originalUri?: string) => Promise<void>);\n\n  }, []); // empty array, only check on component mount\n\n  React.useEffect(() => {\n    if (!oktaAuth) {\n      return;\n    }\n\n    // Add okta-react userAgent\n    if (oktaAuth._oktaUserAgent) {\n      oktaAuth._oktaUserAgent.addEnvironment(`${PACKAGE_NAME}/${PACKAGE_VERSION}`);\n    } else {\n      console.warn('_oktaUserAgent is not available on auth SDK instance. Please use okta-auth-js@^5.3.1 .');\n    }\n\n    // Update Security provider with latest authState\n    const currentAuthState = oktaAuth.authStateManager.getAuthState();\n    if (currentAuthState !== authState) {\n      setAuthState(currentAuthState);\n    }\n    const handler = (authState: AuthState) => {\n      setAuthState(authState);\n    };\n    oktaAuth.authStateManager.subscribe(handler);\n\n    // Trigger an initial change event to make sure authState is latest\n    oktaAuth.start();\n\n    return () => {\n      oktaAuth.authStateManager.unsubscribe(handler);\n    };\n  }, [oktaAuth]);\n\n  if (!oktaAuth) {\n    const err = new AuthSdkError('No oktaAuth instance passed to Security Component.');\n    return <OktaError error={err} />;\n  }\n\n  if (!restoreOriginalUri) {\n    const err = new AuthSdkError('No restoreOriginalUri callback passed to Security Component.');\n    return <OktaError error={err} />;\n  }\n\n  if (!oktaAuth._oktaUserAgent) {\n    console.warn('_oktaUserAgent is not available on auth SDK instance. Please use okta-auth-js@^5.3.1 .');\n  }\n  else {\n    // use SKIP_VERSION_CHECK flag to control version check in tests\n    // OKTA-465157: remove SKIP_VERSION_CHECK\n    const isAuthJsSupported = SKIP_VERSION_CHECK === '1' ||\n      compareVersions(oktaAuth._oktaUserAgent.getVersion(), AUTH_JS.minSupportedVersion, '>=');\n    if (!isAuthJsSupported) {\n      const err = new AuthSdkError(`\n        Passed in oktaAuth is not compatible with the SDK,\n        minimum supported okta-auth-js version is ${AUTH_JS.minSupportedVersion}.\n      `);\n      return <OktaError error={err} />;\n    }\n  }\n\n  return (\n    <OktaContext.Provider value={{ \n      oktaAuth, \n      authState, \n      _onAuthRequired: onAuthRequired\n    }}>\n      {children}\n    </OktaContext.Provider>\n  );\n};\n\nexport default Security;\n","/*\n * Copyright (c) 2020-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\nimport { useOktaAuth, IOktaContext } from './OktaContext';\n\nconst withOktaAuth = <P extends IOktaContext>(\n  ComponentToWrap: React.ComponentType<P>\n): React.FC<Omit<P, keyof IOktaContext>> => { \n  const WrappedComponent = (props: Omit<P, keyof IOktaContext>) => { \n    const oktaAuthProps = useOktaAuth();\n    return <ComponentToWrap {...oktaAuthProps as IOktaContext } {...props as P} />;\n  };\n  WrappedComponent.displayName = 'withOktaAuth_' + (ComponentToWrap.displayName || ComponentToWrap.name);\n  return WrappedComponent;\n};\n\nexport default withOktaAuth;\n","/*\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\nimport { useOktaAuth, OnAuthResumeFunction } from './OktaContext';\nimport OktaError from './OktaError';\n\ninterface LoginCallbackProps {\n  errorComponent?: React.ComponentType<{ error: Error }>;\n  onAuthResume?: OnAuthResumeFunction;\n  loadingElement?: React.ReactElement;\n}\n\nconst LoginCallback: React.FC<LoginCallbackProps> = ({ errorComponent, loadingElement = null, onAuthResume }) => { \n  const { oktaAuth, authState } = useOktaAuth();\n  const [callbackError, setCallbackError] = React.useState(null);\n\n  const ErrorReporter = errorComponent || OktaError;\n  React.useEffect(() => {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore OKTA-464505: backward compatibility support for auth-js@5\n    const isInteractionRequired = oktaAuth.idx.isInteractionRequired || oktaAuth.isInteractionRequired.bind(oktaAuth);\n    if (onAuthResume && isInteractionRequired()) {\n      onAuthResume();\n      return;\n    }\n    oktaAuth.handleLoginRedirect().catch(e => {\n      setCallbackError(e);\n    });\n  }, [oktaAuth]);\n\n  const authError = authState?.error;\n  const displayError = callbackError || authError;\n  if (displayError) { \n    return <ErrorReporter error={displayError}/>;\n  }\n\n  return loadingElement;\n};\n\nexport default LoginCallback;\n","/*\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\nimport { useOktaAuth, OnAuthRequiredFunction } from './OktaContext';\nimport * as ReactRouterDom from 'react-router-dom';\nimport { toRelativeUrl, AuthSdkError } from '@okta/okta-auth-js';\nimport OktaError from './OktaError';\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nlet useMatch: any;\nif ('useRouteMatch' in ReactRouterDom) {\n  // trick static analyzer to avoid \"'useRouteMatch' is not exported\" error\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  useMatch = (ReactRouterDom as any)['useRouteMatch' in ReactRouterDom ? 'useRouteMatch' : ''];\n} else {\n  // throw when useMatch is triggered\n  useMatch = () => { \n    throw new AuthSdkError('Unsupported: SecureRoute only works with react-router-dom v5 or any router library with compatible APIs. See examples under the \"samples\" folder for how to implement your own custom SecureRoute Component.');\n  };\n}\n\nconst SecureRoute: React.FC<{\n  onAuthRequired?: OnAuthRequiredFunction;\n  errorComponent?: React.ComponentType<{ error: Error }>;\n} & ReactRouterDom.RouteProps & React.HTMLAttributes<HTMLDivElement>> = ({ \n  onAuthRequired,\n  errorComponent,\n  ...routeProps\n}) => { \n  const { oktaAuth, authState, _onAuthRequired } = useOktaAuth();\n  const match = useMatch(routeProps);\n  const pendingLogin = React.useRef(false);\n  const [handleLoginError, setHandleLoginError] = React.useState<Error | null>(null);\n  const ErrorReporter = errorComponent || OktaError;\n\n  React.useEffect(() => {\n    const handleLogin = async () => {\n      if (pendingLogin.current) {\n        return;\n      }\n\n      pendingLogin.current = true;\n\n      const originalUri = toRelativeUrl(window.location.href, window.location.origin);\n      oktaAuth.setOriginalUri(originalUri);\n      const onAuthRequiredFn = onAuthRequired || _onAuthRequired;\n      if (onAuthRequiredFn) {\n        await onAuthRequiredFn(oktaAuth);\n      } else {\n        await oktaAuth.signInWithRedirect();\n      }\n    };\n\n    // Only process logic if the route matches\n    if (!match) {\n      return;\n    }\n\n    if (!authState) {\n      return;\n    }\n\n    if (authState.isAuthenticated) {\n      pendingLogin.current = false;\n      return;\n    }\n\n    // Start login if app has decided it is not logged in and there is no pending signin\n    if(!authState.isAuthenticated) { \n      handleLogin().catch(err => {\n        setHandleLoginError(err as Error);\n      });\n    }  \n\n  }, [\n    authState,\n    oktaAuth, \n    match, \n    onAuthRequired, \n    _onAuthRequired\n  ]);\n\n  if (handleLoginError) {\n    return <ErrorReporter error={handleLoginError} />;\n  }\n\n  if (!authState || !authState.isAuthenticated) {\n    return null;\n  }\n\n  return (\n    <ReactRouterDom.Route\n      { ...routeProps }\n    />\n  );\n};\n\nexport default SecureRoute;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}